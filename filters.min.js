filtersJs = {

    addPositiveKeyword: function(parent) {
        //addPositiveKeyword
        filtersJs.addKeyword(parent, true);
    },

    addNegativeKeywords: function(parent) { 
        //addNegativeKeyword
        filtersJs.addKeyword(parent, false);
    },

    getPositiveKeywords: function(parent) {
        var arr = [];
        $(parent).find(".label-info").each(function(index, elem) {
            arr.push($(this).text());
        });
        return arr;
    },

    getNegativeKeywords: function(parent) {
        var arr = [];
        $(parent).find(".label-important").each(function(index, elem) {
            arr.push($(this).text());
        });
        return arr;
    },

    removeKeyword: function(parent, value) {
        $(parent).find('span').filter(function() {
            return $.trim($(this).text()) == value;
        }).remove();
    },
 
    validateValue: function(parent) {
        let value = $(parent).find('#keyword').val(); //.toLowerCase();

        if (filtersJs.findValue(parent, value)) {

            $(parent).find('#btnKeywordI').prop('disabled', false);
            $(parent).find('#btnKeywordE').prop('disabled', false);
            return true;
        } else {
            $(parent).find('#btnKeywordI').prop('disabled', true);
            $(parent).find('#btnKeywordE').prop('disabled', true);
            return false;
        }
    },

    findValue: function(parent, value) {
        // if the parent has a datalist, and there are option elements inside the datalist, then the value must exists in the datalist
        if ($(parent).find("#"+parent.id+"_list").length > 0) {
            if ($(parent).find("#"+parent.id+"_list").children().length > 0) {
                if ($(parent).find("#"+parent.id+"_list").find("option[value='" + value + "']").length > 0) {
                    return true;
                } else {
                    return false;
                }
            } else {
                return true;
            }
        } else {
            return true;
        }
    },

    // add tags with true/false--positive/negative
    addKeyword: function(parent, isPositive) {
        input = $(parent).find("#keyword").get(0);
        transcription =$(parent).find("#keywords_transcription").get(0);

        if (isPositive == true) {
            sClass = "label-info"
/*
            //alert(input.value);
            if (h['on_positive_keyword_added'] != null)
                h['on_positive_keyword_added'](input.value + "");
*/
        } else {
            sClass = "label-important"
/*
            //alert(input.value);
            if (h['on_negative_keyword_added'] != null)
                h['on_negative_keyword_added'](input.value + "");
            //alert(input.value);
*/
        }

        div = $(parent).find("#keywords").get(0);
        s = '<span class="label ' + sClass + '" valign="middle" value="' + input.value + '">' +
            "<a href='javascript:void(0)' onclick='$(this).parent().remove();filtersJs.updateKeywordsTranscriptions();' class='close' data-dismiss='alert'> <i class='icon-remove-sign'></i></a> " + input.value + " " +
            "</span> "

        // if the value is empty, do not add it
        if (input.value.trim().length == 0) {
            return;
        }
        // if the parent has a datalist, and there are option elements inside the datalist, then the value must exists in the datalist
        if ( filtersJs.findValue(parent, input.value) == false ) {
            return;            
        }

        div.innerHTML = div.innerHTML + s

        transcription.value = div.innerHTML
        input.value = ""
        $(parent).find('#btnKeywordI').attr('disabled', true);
        $(parent).find('#btnKeywordE').attr('disabled', true);

        // set focus on the input box, to add another keyword
        input.focus();
    },

    updateKeywordsTranscriptions: function(parent) {
        transcription = $(parent).find("#keywords_transcription").get(0);
        div = $(parent).find("#keywords").get(0);
        transcription.value = div.innerHTML;
    },

    draw: function(parent, h) {
        var s =
            "<div class='control-group span4'>" +
            "	<label class='control-label' for='inputKeywords'>"+h['label']+"</label>" +
            "	<div class='controls'>" +
            "		<div class='row-fluid'>" +
            "			<div class='span8'>" +
            "				<input onchange='' type='text' class='input-large' name='keyword' id='keyword' list='"+parent.id+"_list' placeholder='Write "+h['label']+" here' tabindex='2' />" +
            "				<datalist id='"+parent.id+"_list'>" +
            "				</datalist>" +
            "				<input type='hidden' name='keywords_transcription' id='keywords_transcription' value='' />" +
            "				<p >Press ENTER to add the keyword. Or use the include/exclude buttons.</p>" +
            "			</div>" +
            "			<div class='span4'>" +
            "				<button id='btnKeywordI' class='include-button btn btn-mini btn-blue' type='button' disabled><i class='icon-plus' tabindex='-1'></i> Include</button>" +
            "				<button id='btnKeywordE' class='exclude-button btn btn-mini btn-red' type='button'  disabled><i class='icon-minus' tabindex='-1'></i> Exclude</button>" +
            "			</div>" +
            "		</div>" +

            "		<div id='keywords' name='keywords'></div>" +
            "	</div>" +
            "</div>";

        // // add html
        $(parent).html(s);


        if (h['allowed_positive_keywords'] != null) {
            if (h['allowed_positive_keywords'] == false) {
                $(parent).find('#btnKeywordI').hide();
            }
        }

        if (h['allowed_negative_keywords'] != null) {
            if (h['allowed_negative_keywords'] == false) {
                $(parent).find('#btnKeywordE').hide();
            }
        }


        if (h['allowed_values'] == null) {
            //console.log("please add allowed_values")
        } else {
            $.each(h['allowed_values'], function(index, value) {
                $(parent).find("#"+parent.id+"_list").append('<option value="' + value + '">' + value + '</option>')
            });
        }

        $(parent).find('#keyword').on('input', function() {

            if (h['allowed_values'] == null) {
                var i = $.trim($(this).val()).length;
                if (i > 0) {
                    $(parent).find('#btnKeywordI').prop('disabled', false);
                    $(parent).find('#btnKeywordE').prop('disabled', false);
                } else {
                    $(parent).find('#btnKeywordI').prop('disabled', true);
                    $(parent).find('#btnKeywordE').prop('disabled', true);
                }

            } else
                filtersJs.validateValue(parent);
        });

        // event: on click ENTER button
        $(parent).find('#keyword').keydown(function(e) {
            if (e.which == 13) { // ENTER
                filtersJs.addKeyword(parent, true);
            }
        });

        // include button add tag
        $(parent).find('.include-button').click(function() {
            filtersJs.addKeyword(parent, true);
        });


        // exclude button add tag
        $(parent).find('.exclude-button').click(function() {
            filtersJs.addKeyword(parent, false);
        });
    },
};